---
import NavBar from '../components/NavBar.astro';
import Layout from '../layouts/Layout.astro';
---

<Layout>
	<div class="pagos-container">
		<!-- Panel lateral izquierdo -->
		<NavBar />

		<!-- Contenido principal -->
		<div class="flex-1 flex flex-col overflow-hidden">
			<header class="bg-gray-100 shadow-sm border-b border-gray-200">
				<div class="flex items-center justify-between px-6 py-4">
					<div id="TituloTabla" class="flex">
						<h1 class="text-2xl font-bold text-[#2F5D50]">HISTORIAL DE CITAS</h1>
						<div class="flex ml-5 space-x-4">
							<input 
								type="text" 
								placeholder="Buscar..." 
								class="auth-input px-4 py-2 w-64"
							>
						</div>
					</div>
					<div class="flex items-center space-x-4">
						<span class="text-sm text-gray-600 justify-items-end">Bienvenido</span>
						<button onclick="logout()" class="auth-button px-4 py-2 text-sm">
							Cerrar Sesi√≥n
						</button>
					</div>
				</div>
			</header>

			<main class="flex-1 overflow-y-auto p-6">
				<!-- üîç BARRA DE HERRAMIENTAS -->
				<div class="pagos-header">
					

					<div class="pagos-controls">
						
						<!-- Bot√≥n de exportaci√≥n con men√∫ desplegable -->
						<div class="relative">
							
							<!-- Men√∫ oculto que se muestra al hacer clic -->
							<div class="hidden absolute right-0 mt-2 w-32 bg-white rounded-lg shadow-lg py-2 z-10">
								<a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100">PDF</a>
								<a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100">XML</a>
								<a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100">JSON</a>
							</div>
						</div>
					</div>
				</div>

				<!-- üìã TABLA DE CITAS -->
				<div class="pagos-table-wrapper">
					<table class="pagos-table w-full">
						<thead>
							<tr class="table-header">
								<th>Fecha</th>
								<th>Nombre del Paciente</th>
								<th>Motivo de Consulta</th>
								<th>Estatus</th>
								<th>Acciones</th>
							</tr>
						</thead>
						<tbody class="divide-y divide-gray-200">
							<tr>
								<td>09/06/2025</td>
								<td>Ian</td>
								<td>Ondas de Choque</td>
								<td><span class="status-pending">Pendiente</span></td>
								<td>
									<div class="relative">
										<button class="auth-button px-3 py-1 text-sm">Acciones</button>
										<div class="hidden absolute right-0 mt-2 w-32 bg-white rounded-lg shadow-lg py-2 z-10">
											<a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100">Abrir</a>
											<a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100">Editar</a>
											<a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100 text-red-600">Eliminar</a>
										</div>
									</div>
								</td>
							</tr>

							<tr>
								<td>09/06/2025</td>
								<td>Jacqueline</td>
								<td>Terapia Normal</td>
								<td><span class="status-confirmed">Confirmada</span></td>
								<td>
									<button class="auth-button px-3 py-1 text-sm">Acciones</button>
								</td>
							</tr>

							<tr>
								<td>09/06/2025</td>
								<td>Jessika</td>
								<td>Plantillas</td>
								<td><span class="status-cancelled">Cancelada</span></td>
								<td>
									<button class="auth-button px-3 py-1 text-sm">Acciones</button>
								</td>
							</tr>
						</tbody>
					</table>
				</div>

				<!-- üìÑ PAGINACI√ìN -->
				<div class="historial-pagination">
					<div class="text-sm text-gray-600">1‚Äì10 de 99</div>
					<div class="flex items-center gap-3">
						<span class="text-sm text-gray-600">Filas por p√°gina:</span>
						<select class="historial-select">
							<option>10</option>
							<option>25</option>
							<option>50</option>
						</select>
						<div class="flex items-center gap-2">
							<button class="btn-action px-3 py-1 text-sm">‚ü®</button>
							<span class="text-sm text-gray-600">1/10</span>
							<button class="btn-action px-3 py-1 text-sm">‚ü©</button>
						</div>
					</div>
				</div>
			</main>
		</div>
	</div>

	<!-- ======================= -->
	<!-- üîß SCRIPT ORIGINAL (DOCUMENTADO) -->
	<!-- ======================= -->
	<script>
		/**
		 * üîê Funci√≥n de cierre de sesi√≥n.
		 * Elimina el token JWT almacenado en localStorage y redirige al inicio.
		 */
		function logout() {
			localStorage.removeItem('token');
			window.location.href = '/';
		}

		/**
		 * üß≠ Evento principal del documento:
		 * - Recupera el token almacenado (si existe)
		 * - Configura los dropdowns (botones de acciones y exportar)
		 * - Cierra los dropdowns si se hace clic fuera
		 */
		document.addEventListener('DOMContentLoaded', function() {
			// Recupera el token JWT del almacenamiento local
			const token = localStorage.getItem('token');
			

			// Configura los eventos de los botones con men√∫ desplegable
			document.querySelectorAll('.relative button').forEach(button => {
				button.addEventListener('click', function(e) {
					e.stopPropagation(); // Evita que el clic cierre el men√∫ inmediatamente
					const dropdown = this.nextElementSibling; // Selecciona el div oculto
					dropdown.classList.toggle('hidden'); // Alterna la visibilidad del men√∫
				});
			});

			// Cierra todos los men√∫s desplegables al hacer clic fuera
			document.addEventListener('click', function() {
				document.querySelectorAll('.relative > div').forEach(dropdown => {
					dropdown.classList.add('hidden');
				});
			});
		});
	</script>
</Layout>
