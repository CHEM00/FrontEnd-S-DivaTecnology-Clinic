---
import NavBar from '../components/NavBar.astro';
import Layout from '../layouts/Layout.astro';
import axios from 'axios';
const table = await axios.get('http://localhost:3000/api/v1/HistorialClinico').then((res) => res.data);
const date = (d: Date) => { const dt = new Date(d); return dt.toLocaleDateString('es-MX', { year: 'numeric', month: '2-digit', day: '2-digit' }); };
---

<Layout title="Historial de citas">
	<div class="pagos-container">
		<!-- Panel lateral izquierdo -->
		<NavBar />

		<!-- Contenido principal -->
		<div class="flex-1 flex flex-col overflow-hidden">
			<header class="bg-white/80 shadow-sm border-b border-gray-200">
				<div class="flex items-center justify-between px-6 py-4">
					<div class="flex">
						<h1>Historial de citas</h1>
						<div class="flex ml-5 space-x-4">
							<input 
								type="text" 
								placeholder="Buscar..." 
								class="auth-input px-4 py-2 w-64"
							>
						</div>
					</div>
				</div>
			</header>
            <main>
                <div id="TableContainer">
                    <table id="Table">
				        <thead>
						    <tr id="TableHeader">
								<th><input type="checkbox" /></th>
								<th>Fecha</th>
								<th>Diagnosticos</th>
								<th>Nombre del paciente</th>
								<th>Numero de sesion</th>
								<th>Nota terapeutica</th>
								<th>Acciones</th>
							</tr>
						</thead>
						<tbody>
                            {table.map((Cita) => (
							<tr>
								<td><input type="checkbox" /></td>
								<td>{date(Cita.Fecha)}</td>
								<td>{Cita.Diagnostico}</td>
								<td>{Cita.NombrePaciente}</td>
								<td>{Cita.NumeroCita}</td>
								<td>{Cita.NotaTerapeutica}</td>
								<td>
									<button class="btn-action">Acciones</button>
								</td>
							</tr>
                            ))}
						</tbody>
					</table>
				<!-- PAGINACIÓN Y BOTONES -->
				<div class="historial-pagination">
					<div class="text-sm text-gray-600">1–10 de 99</div>
					<div class="flex items-center gap-3">
						<span class="text-sm text-gray-600">Filas por página:</span>
						<select class="historial-select">
							<option>10</option>
							<option>25</option>
							<option>50</option>
						</select>
						<div class="flex items-center gap-2">
							<button class="btn-action px-3 py-1 text-sm">⟨</button>
							<span class="text-sm text-gray-600">1/10</span>
							<button class="btn-action px-3 py-1 text-sm">⟩</button>
						</div>
					</div>
				</div>
                </div>	
			</main>
		</div>
	</div>
</Layout>